<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#1a365d">
    <title>CYA Dashboard - Christian Youth in Action</title>
    <link rel="icon" href="favicon.svg" type="image/svg+xml">
    <link rel="manifest" href="/manifest.json">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="dns-prefetch" href="//api.example.com">
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/dashboard.css">
    <script defer>
      if ('serviceWorker' in navigator && location.protocol === 'https:') {
        window.addEventListener('load', () => {
          navigator.serviceWorker.register('/service-worker.js').catch(err => console.log('SW registration failed:', err));
        });
      } else if ('serviceWorker' in navigator) {
        navigator.serviceWorker.register('/service-worker.js').catch(err => console.log('SW registration failed:', err));
      }
    </script>
</head>
<body class="dashboard-page">
    <!-- Top Navigation -->
    <nav class="navbar" id="topNav">
        <div class="nav-brand">
            <span class="cross-icon">âœ</span>
            <span class="brand-text">CYA</span>
        </div>
        <div class="nav-links" id="navMiddle">
            <a href="game.html">ğŸ“– Bible Trivia</a>
            <a href="games.html">ğŸ® Bible Games</a>
            <a href="dashboard.html">ğŸ“Š Dashboard</a>
            <a href="leaderboard.html">ğŸ† Leaderboard</a>
            <span id="userDisplay"></span>
            <button class="btn btn-danger btn-small" onclick="logout()">Logout</button>
        </div>
        <div class="mobile-menu" id="mobileMenuBtn" onclick="toggleMobileMenu()">
            <span></span>
            <span></span>
            <span></span>
        </div>
    </nav>

    <div class="mobile-nav" id="mobileNav">
        <a href="game.html" onclick="toggleMobileMenu()">ğŸ“– Bible Trivia</a>
        <a href="games.html" onclick="toggleMobileMenu()">ğŸ® Bible Games</a>
        <a href="dashboard.html" onclick="toggleMobileMenu()">ğŸ“Š Dashboard</a>
        <a href="leaderboard.html" onclick="toggleMobileMenu()">ğŸ† Leaderboard</a>
        <span id="userDisplayMobile"></span>
        <button class="btn btn-danger btn-small btn-mobile-logout" onclick="logoutMobile()">Logout</button>
    </div>

    <div class="container">

        <!-- Dashboard Container -->
        <div id="dashboardContainer" class="dashboard-container">
            <!-- Sidebar -->
            <aside class="sidebar">
                <button class="panel-close-btn" onclick="closePanels()" aria-label="Close Sidebar">Ã—</button>
                <div class="sidebar-section">
                    <h3>Member Role</h3>
                    <div id="memberChurch" class="member-role-badge">Loading...</div>
                </div>
                <!-- Quick Links removed: functionality merged into Quick Access on the right -->
            </aside>

            <!-- Main Content -->
            <main class="main-content main-responsive">
                <!-- Memory Verse Display -->
                <div id="memoryVerseWidget" class="memory-verse-widget">
                    <div class="verse-title">âœï¸ Today's Memory Verse</div>
                    <div id="memoryVerseText" class="verse-text">Loading...</div>
                    <div id="memoryVerseReference" class="verse-reference">Bible</div>
                </div>

                <!-- Announcements Section -->
                <div class="announcements-wrapper">
                    <div class="section-header">
                        <h2>ğŸ“¢ Announcements</h2>
                        <button class="btn btn-sm" id="newAnnouncementBtn" onclick="showAnnouncementForm()">+ New</button>
                    </div>
                    <div class="new-announcement-form hidden" id="newAnnouncementForm">
                        <input type="text" id="announcementTitle" placeholder="Announcement title" class="form-input">
                        <textarea id="announcementContent" placeholder="Announcement content..." class="post-textarea event-textarea"></textarea>
                        <input type="date" id="announcementDate" class="form-input">
                        <div class="form-actions">
                            <button class="btn btn-primary btn-sm" onclick="saveAnnouncement()">Save Announcement</button>
                            <button class="btn btn-secondary btn-sm" onclick="cancelAnnouncement()">Cancel</button>
                        </div>
                    </div>
                    <div class="announcements-list" id="announcementsList">
                        <div class="empty-state">No announcements yet</div>
                    </div>
                </div>

                <!-- Floating Chat Widget -->
                <div id="floatingChat" class="floating-chat" style="display: none;">
                    <div class="floating-chat-header" id="chatDragHandle">
                        <div class="chat-title-bar">
                            <h3>ğŸ’¬ Group Chat</h3>
                            <span class="chat-info-badge">7 days retention</span>
                        </div>
                        <div class="chat-controls">
                            <button class="chat-control-btn clear-btn" id="clearChatBtn" onclick="clearAllMessages()" title="Clear all messages" style="display: none;">ğŸ—‘ï¸</button>
                            <button class="chat-control-btn minimize-btn" id="minimizeBtn" onclick="minimizeChat()" title="Minimize">âˆ’</button>
                            <button class="chat-control-btn maximize-btn hidden" id="maximizeBtn" onclick="maximizeChat()" title="Maximize">â–¡</button>
                            <button class="chat-control-btn close-btn" onclick="closeChat()" title="Close">Ã—</button>
                        </div>
                    </div>
                    <div class="floating-chat-body">
                        <div class="online-users-section">
                            <div class="online-users-label">ğŸŸ¢ Online Users</div>
                            <div class="online-users-scroll" id="onlineUsersList">
                                <div class="online-user-item">
                                    <span class="online-status"></span>
                                    <span class="online-user-name">Loading...</span>
                                </div>
                            </div>
                        </div>
                        <div class="chat-container floating-chat-styled">
                            <div class="chat-messages" id="chatMessages">
                                <div class="empty-state">
                                    <span class="empty-icon">ğŸ’¬</span>
                                    <p>Start the conversation!</p>
                                    <p class="empty-subtitle">Be the first to send a message to the group.</p>
                                </div>
                            </div>
                            <div id="typingIndicator" class="typing-indicator hidden">
                                <span id="typingUsers"></span>
                                <span class="typing-dots"><span></span><span></span><span></span></span>
                            </div>
                            <div id="replyIndicator" class="reply-indicator hidden">
                                <div class="reply-label">â†©ï¸ Replying to: <span id="replyUsername">username</span></div>
                                <button class="reply-close" onclick="cancelReply()">Ã—</button>
                            </div>
                            <div class="chat-input-area">
                                <div class="chat-input-wrapper">
                                    <button class="emoji-picker-btn" onclick="toggleEmojiPicker()" title="Add emoji">ğŸ˜Š</button>
                                    <input type="text" id="chatInput" placeholder="Type a message..." class="chat-input" maxlength="500" onkeypress="handleChatKeyPress(event)">
                                    <span class="chat-char-count" id="chatCharCount">0/500</span>
                                </div>
                                <button id="chatSendBtn" class="btn btn-chat-send" onclick="sendChatMessage()">
                                    <span>Send</span>
                                </button>
                            </div>
                            <div id="emojiPicker" class="emoji-picker hidden">
                                <div class="emoji-grid">
                                    ğŸ˜Š ğŸ˜‚ â¤ï¸ ğŸ˜ ğŸ”¥ ğŸ‘ ğŸ˜ ğŸ˜¢ ğŸ˜¡ ğŸ˜± ğŸ‘ ğŸ‰ ğŸ™ ğŸ˜Œ ğŸ˜´ ğŸ˜’ ğŸ’¯ âœ¨ ğŸŒŸ â­ ğŸŠ ğŸ’ª ğŸ¤” ğŸ¤· ğŸ˜… ğŸ˜˜ ğŸ˜š ğŸ˜™ ğŸ¤ ğŸ˜¶
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="floating-chat-resize" id="chatResizeHandle"></div>
                </div>
                
                <!-- Chat Toggle Button -->
                <button id="chatToggleBtn" class="chat-toggle-btn" onclick="toggleChat()" title="Open Chat">
                    ğŸ’¬
                    <span id="chatUnreadBadge" class="chat-unread-badge" style="display: none;">0</span>
                </button>

                <!-- Tabs Section for other content -->
                <div class="tabs-section">
                    <div class="tabs-header">
                        <button class="tab-btn active" data-tab="tasks" onclick="switchTab('tasks', this)">ğŸ“‹ Tasks</button>
                        <button class="tab-btn" data-tab="activities" onclick="switchTab('activities', this)">ğŸ¯ Activities</button>
                        <button class="tab-btn" data-tab="posts" onclick="switchTab('posts', this)">ğŸ“ Posts</button>
                    </div>

                    <!-- Tasks Section -->
                    <section id="tasks" class="content-section active">
                        <div class="section-header">
                            <h2>ğŸ“‹ Tasks & Responsibilities</h2>
                            <button class="btn btn-sm" onclick="showTaskForm()">+ New Task</button>
                        </div>
                        <div class="new-task-form hidden" id="newTaskForm">
                            <input type="text" id="taskTitle" placeholder="Task title" class="form-input">
                            <input type="text" id="taskAssignee" placeholder="Assign to..." class="form-input">
                            <select id="taskPriority" class="form-input">
                                <option value="low">Low Priority</option>
                                <option value="medium" selected>Medium Priority</option>
                                <option value="high">High Priority</option>
                            </select>
                            <input type="hidden" id="taskEditId">
                            <div class="form-actions">
                                <button class="btn btn-primary btn-sm" onclick="saveTask()">Save Task</button>
                                <button class="btn btn-secondary btn-sm" onclick="cancelTask()">Cancel</button>
                            </div>
                        </div>
                        <div class="tasks-list" id="tasksList">
                            <div class="empty-state">No tasks assigned</div>
                        </div>
                    </section>

                    <!-- Activities Section -->
                    <section id="activities" class="content-section">
                        <div class="section-header">
                            <h2>ğŸ¯ Activities & Events</h2>
                            <button class="btn btn-sm hidden" id="newEventBtn" onclick="showEventForm()">+ New Event</button>
                        </div>
                        <div class="mission-statement hidden" id="missionStatement">
                            <p><strong>CYA Mission:</strong> Christian Youth in Action - "Don't let anyone look down on you because you are young, but set an example for the believers in speech, in conduct, in love, in faith and in purity." (1 Timothy 4:12)</p>
                            <p>Our vision is to empower Christian youth to grow spiritually, serve their community, and become strong witnesses for Christ.</p>
                        </div>
                        <div class="new-event-form hidden" id="newEventForm">
                            <input type="text" id="eventTitle" placeholder="Event title" class="form-input">
                            <input type="date" id="eventDate" class="form-input">
                            <textarea id="eventDescription" placeholder="Event description..." class="post-textarea event-textarea"></textarea>
                            <input type="hidden" id="eventEditId">
                            <div class="form-actions">
                                <button class="btn btn-primary btn-sm" onclick="saveEvent()">Save Event</button>
                                <button class="btn btn-secondary btn-sm" onclick="cancelEvent()">Cancel</button>
                            </div>
                        </div>
                        <div class="activities-list" id="activitiesList">
                            <div class="empty-state">No activities scheduled</div>
                        </div>
                    </section>

                    <!-- Posts Section -->
                    <section id="posts" class="content-section">
                        <div class="section-header">
                            <h2>ğŸ“ Ideas & Posts</h2>
                            <button class="btn btn-sm" id="newPostBtn">+ Share Idea</button>
                        </div>
                        <div class="new-post-form hidden" id="newPostForm">
                            <textarea id="postContent" placeholder="Share your idea or thought..." class="post-textarea"></textarea>
                            <input type="text" id="postCaption" placeholder="Optional caption for image..." class="form-input" />
                            <input type="file" id="postImage" accept="image/*" />
                            <input type="hidden" id="postEditId">
                            <div class="post-actions">
                                <button class="btn btn-primary btn-sm" id="postSubmitBtn" onclick="createPost()">Post</button>
                                <button class="btn btn-secondary btn-sm" onclick="cancelPost()">Cancel</button>
                            </div>
                        </div>
                        <div class="posts-list" id="postsList">
                            <div class="empty-state">No posts yet. Be the first to share!</div>
                        </div>
                    </section>
                </div>
            </main>

            <!-- Right Sidebar - Quick Access -->
            <aside class="right-sidebar">
                <button class="panel-close-btn" onclick="closePanels()" aria-label="Close Quick Access">Ã—</button>
                <div class="sidebar-section">
                    <h3>âš¡ Quick Access</h3>
                    <div class="quick-access-grid">
                        <a href="game.html" class="quick-btn">ğŸ® Play Bible Trivia</a>
                        <a href="games.html" class="quick-btn">ğŸ•¹ï¸ Play Games</a>
                        <a href="leaderboard.html" class="quick-btn">ğŸ† Leaderboard</a>
                        <a href="#" class="quick-btn" onclick="scrollToChat(); return false;">ğŸ’¬ Open Chat</a>
                        <a href="profile.html" class="quick-btn">ğŸ‘¤ Profile</a>
                    </div>
                </div>
                <div class="sidebar-section">
                    <h3>ğŸ‘¥ Members Online</h3>
                    <div class="members-list" id="membersList">
                        <div class="member-item">Loading...</div>
                    </div>
                </div>
            </aside>
        </div>
    </div>

    <!-- Toast Notification Container -->
    <div id="notificationContainer" class="notification-container"></div>

    <!-- Mobile quick toggles -->
    <button id="quickAccessToggle" class="mobile-quick-toggle quick-access-toggle" onclick="toggleQuickAccess()" title="Quick Access">âš¡</button>

    <!-- Styled Confirmation Modal -->
    <div id="confirmationModal" class="confirmation-modal hidden">
        <div class="confirmation-content">
            <h3 id="confirmTitle">Confirm Action</h3>
            <p id="confirmMessage"></p>
            <div class="confirmation-actions">
                <button class="btn btn-secondary btn-sm" onclick="cancelConfirmation()">Cancel</button>
                <button class="btn btn-danger btn-sm" id="confirmButton" onclick="executeConfirmation()">Confirm</button>
            </div>
        </div>
    </div>

    <script src="js/session.js"></script>
    <script src="/socket.io/socket.io.js"></script>
    <script src="js/dashboard.js"></script>
</body>
</html>
